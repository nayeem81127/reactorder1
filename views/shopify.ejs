<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Responsive Admin Dashboard Template">
  <meta name="keywords" content="admin,dashboard">
  <meta name="author" content="stacks">
  <!-- The above 6 meta tags *must* come first in the head; any other head content must come *after* these tags -->

  <!-- Title -->
  <title>Shopify</title>

  <!-- Styles -->
  <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,700,800&display=swap" rel="stylesheet">
  <link href="/public/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/public/plugins/font-awesome/css/all.min.css" rel="stylesheet">
  <link href="/public/plugins/perfectscroll/perfect-scrollbar.css" rel="stylesheet">
  <link href="/public/plugins/apexcharts/apexcharts.css" rel="stylesheet">

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  <script src="/public/js/apexcharts.js"></script>
  <!-- Theme Styles -->
  <link href="/public/css/main.min.css" rel="stylesheet">
  <link href="/public/css/custom.css" rel="stylesheet">
  <style>
    .fa-large {
      font-size: 30px;
      padding: 10px;
    }
  </style>
  <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
        <![endif]-->
</head>

<body>

  <div class='loader'>
    <div class='spinner-grow text-primary' role='status'>
      <span class='sr-only'>Loading...</span>
    </div>
  </div>
  <div class="page-container">
    <div class="page-header">
      <nav class="navbar navbar-expand-lg d-flex justify-content-between">
        <div class="" id="navbarNav">
          <ul class="navbar-nav" id="leftNav">
            <li class="nav-item">
              <a class="nav-link" id="sidebar-toggle" href="#"><i data-feather="menu"></i></a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="#"></a>
            </li>

          </ul>
        </div>
        <div class="logo1">
          <h3 class="card-title mb-0"> <img src="/public/images/shopify.png" width="50"></img>
            <%= locals.username %>, Shopify
          </h3>
        </div>
        <div class="" id="headerNav">
          <div class="row">
            <div class="col-md-7">
              <select id="drop_joblogs" class="form-select" aria-label="Default select example">
                <option value="All">All</option>
                <% for(var i=0; i < locals.shopDetails.rows.length; i++) { %>
                  <option value="<%= locals.shopDetails.rows[i].shopify_domain %>">
                    <%= locals.shopDetails.rows[i].shopify_domain.split('.', 1) %>
                  </option>
                  <% } %>
              </select>
            </div>
            <div class="col-md-5">
              <a href="/addShop" class="btn btn-warning m-b-xs">Manage</a>
            </div>
          </div>
        </div>
      </nav>
    </div>
    <div class="page-sidebar">
      <ul class="list-unstyled accordion-menu">
        <li class="sidebar-title">
          Main
        </li>
        <li>
          <a href="/index"><i data-feather="home"></i>Dashboard</a>
        </li>
        <li class="sidebar-title">
          Apps
        </li>
        <% if (locals.shopify==true) { %>
          <li class="active-page">
            <a href="#"><i data-feather="chevron-right"></i>Shopify</a>
          </li>
          <% } %>
            <% if (locals.ebay==true) { %>
              <li>
                <a href="/ebay"><i data-feather="chevron-right"></i>Ebay</a>
              </li>
              <% } %>
                <% if (locals.amaz==true) { %>
                  <li>
                    <a href="/amazon"><i data-feather="chevron-right"></i>Amazon</a>
                  </li>
                  <% } %>
                    <% if (locals.majento==true) { %>
                      <li>
                        <a href="#"><i data-feather="chevron-right"></i>Majento</a>
                      </li>
                      <% } %>
                        <% if (locals.wooCommerce==true) { %>
                          <li>
                            <a href="/woocommerce"><i data-feather="chevron-right"></i>Woo Commerce</a>
                          </li>
                          <% } %>
                            <% if (locals.bigCommerce==true) { %>
                              <li>
                                <a href="/bigcommerce"><i data-feather="chevron-right"></i>Big Commerce</a>
                              </li>
                              <% } %>
                                <% if (locals.etsy==true) { %>
                                  <li>
                                    <a href="/etsy"><i data-feather="chevron-right"></i>ETSY</a>
                                  </li>
                                  <% } %>
                                    <% if (locals.quickBooks==true) { %>
                                      <li>
                                        <a href="/quickbooks"><i data-feather="chevron-right"></i>Quick Books</a>
                                      </li>
                                      <% } %>
                                        <li class="sidebar-title">
                                          Other Services
                                        </li>
                                        <li>
                                          <a href="#"><i data-feather="settings"></i>Services<i
                                              class="fas fa-chevron-right dropdown-icon"></i></a>
                                          <ul class="">
                                            <li><a href="/updateAqxolt"><i class="far fa-circle"></i>Update Aqxolt
                                                Info</a></li>
                                            <% if (locals.manage==true) { %>
                                              <li><a href="/manage"><i class="far fa-circle"></i>Manage Users</a></li>
                                              <li><a href="typography.html"><i class="far fa-circle"></i>Background
                                                  Jobs</a></li>
                                              <% } %>
                                          </ul>
                                        </li>

                                        <li class="sidebar-title">
                                          Manage Account
                                        </li>
                                        <li>
                                          <a href="#"><i data-feather="user"></i>Profile<i
                                              class="fas fa-chevron-right dropdown-icon"></i></a>
                                          <ul class="">
                                            <li><a href="/manage-edit"><i class="far fa-circle"></i>Manage</a></li>
                                            <li><a href="/logout"><i class="far fa-circle"></i>logout</a></li>

                                          </ul>
                                        </li>

      </ul>
    </div>
    <% if (success_msg.length> 0) { %>
      <div class="alert alert-success alert-dismissible fade show"
        style="width: 62%;position: absolute;top: 15%;z-index: 99;left: 20%;" role="alert">
        <%= locals.success_msg %>
          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>

      <% } %>
        <% if (error_msg.length> 0) { %>
          <div class="alert alert-warning alert-dismissible fade show"
            style="width: 62%;position: absolute;top: 15%;z-index: 99;left: 20%;" role="alert">
            <%= locals.error_msg %>
              <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>

          <% } %>
            <div class="page-content">
              <div class="main-wrapper">
                <div class="row">
                  <div class="col-lg">
                    <div class="card" id="blockui-card-1">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-3">
                            <i class="fas fa-boxes fa-large"></i>
                          </div>
                          <div class="col-md-9">
                            <h5 class="card-title mb-3">Products</h5>
                            <form id="shopifyProductSync" method="post" action="/shopifyProductSync">
                              <button type="button" class="btn btn-primary" id="ProductSync">Pending Sync &nbsp;<i
                                  class="fas fa-sync"></i></button>
                            </form>
                          </div>
                        </div>



                      </div>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-3">
                            <i class="fas fa-user fa-large"></i>
                          </div>
                          <div class="col-md-9">
                            <h5 class="card-title mb-3">Customers</h5>

                            <form id="shopifyCustomerSync" method="post" action="/shopifyCustomerSync">
                              <button type="button" class="btn btn-primary" id="CustomerSync">Pending Sync &nbsp;<i
                                  class="fas fa-sync"></i></button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="col-lg">
                    <div class="card">
                      <div class="card-body">
                        <div class="row">
                          <div class="col-md-3">
                            <i class="fas fa-shopping-cart fa-large"></i>
                          </div>
                          <div class="col-md-9">
                            <h5 class="card-title mb-3">Orders</h5>
                            <form id="shopifyOrderSync" method="post" action="/shopifyOrderSync">
                              <button type="button" class="btn btn-primary" id="OrderSync">Pending Sync &nbsp;<i
                                  class="fas fa-sync"></i></button>
                            </form>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row">
                  <div class="col-sm-12 col-md-6">
                    <div class="card">
                      <div class="card-body">
                        <h5 class="card-title">Sync</h5>
                        <div id="chart"></div>
                      </div>
                    </div>
                  </div>
                  <div class="col-sm-12 col-md-6">
                    <div class="card">
                      <div class="card-body">
                        <h5 class="card-title">Logs</h5>
                        <div style="height:30.1rem;overflow-y:scroll;margin:-26px;">
                          <table class="table table-condensed display tableId" style="width:100%">
                            <tbody>
                              <% for(var i=0; i < locals.generateLog.rows.length; i++) { %>
                                <tr class="row-row">
                                  <td>
                                    <%= locals.generateLog.rows[i].message %>
                                  </td>
                                  <td>
                                    <%= locals.generateLog.rows[i].updated_at %>
                                  </td>
                                </tr>
                                <% } %>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
  </div>

  <script>
    $(document).ready(function () {
      $(`#drop_joblogs option[value='<%= locals.idValue %>']`).prop('selected', true);

      $('#CustomerSync').on('click', function () {
        var text = 'Do you want Customer sync now?';
        if (confirm(text)) {
          document.getElementById("shopifyCustomerSync").submit();
        }
      });

      $('#ProductSync').on('click', function () {
        var text = 'Do you want Product sync now?';
        if (confirm(text)) {
          document.getElementById("shopifyProductSync").submit();
        }
      });

      $('#OrderSync').on('click', function () {
        var text = 'Do you want Order sync now?';
        if (confirm(text)) {
          document.getElementById("shopifyOrderSync").submit();
        }
      });

      $('#drop_joblogs').on('change', function () {
        var state_id = this.value;
        var url = '/shopify/' + state_id;
        $.ajax({
          url: url,
          type: 'GET',
          success: function (result) {
            console.log('changing...');
            window.location.href = '/shopify/' + state_id;
          },
          error: function (err) {
            console.log(err);
          }
        });
      });
    });
  </script>

  <script>
    var _seed = 42;
    Math.random = function () {
      _seed = _seed * 16807 % 2147483647;
      return (_seed - 1) / 2147483646;
    };
  </script>

  <script>
    var dateString = []
    var datefullString = []
    const timeStamp = new Date().getTime();
    for (let i = 9; i >= 0; --i) {
      const yesterdayTimeStamp = timeStamp - (24 * 60 * 60 * 1000) * i;
      var data = new Date(yesterdayTimeStamp).toLocaleString('en-US', { weekday: 'short', day: 'numeric', year: 'numeric', month: 'long' })
      datefullString.push(data)
      var data = new Date(yesterdayTimeStamp).toLocaleString('en-US', { day: 'numeric', month: 'long' })
      dateString.push(data)
    }

    console.log(datefullString)
    var dataVal = '<%- JSON.stringify(shopcharts.rows) %>';
    dataVal = JSON.parse(dataVal)

    var data1 = [];

    for (let j in dataVal) {
      data1.push(dataVal[j].seller_id)
    }
    var uniq1 = new Set(data1.map(e => JSON.stringify(e)));
    data1 = Array.from(uniq1).map(e => JSON.parse(e));
    console.log(data1.length)

    var series = []
    for (let j in dataVal) {
      data1.forEach((value) => {
        if (value == dataVal[j].seller_id) {
          var data = [];
          var dateExist = [];
          for (let i in dataVal) {
            if (value == dataVal[i].seller_id) {
              dateExist.push(dataVal[i].updated_at)
              data.push(dataVal[i].sync_count)
            }
          }          
          if (data1.length > 1) {
            dateString.forEach(element => {
              if (!dateExist.includes(element)) data.unshift('')
            });
          }else{
            dateString = dateExist;
          }
          var list = {
            name: value.split('.', 1),
            data: data
          }
          series.push(list)
        }
      })
    }

    var uniq1 = new Set(series.map(e => JSON.stringify(e)));
    series = Array.from(uniq1).map(e => JSON.parse(e));
    console.log(series)
    var options = {
      series: series,
      chart: {
        height: 350,
        type: 'area'
      },
      dataLabels: {
        enabled: false
      },
      stroke: {
        curve: 'smooth'
      },
      xaxis: {
        type: 'date',
        categories: dateString
      },
      tooltip: {
        x: {
          format: 'dd/MM/yy'
        },
      },
    };

    var chart = new ApexCharts(document.querySelector("#chart"), options);
    chart.render();


  </script>

  <!-- Javascripts -->

  <script src="/public/plugins/jquery/jquery-3.4.1.min.js"></script>
  <script src="https://unpkg.com/@popperjs/core@2"></script>
  <script src="/public/plugins/bootstrap/js/bootstrap.min.js"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <script src="/public/plugins/perfectscroll/perfect-scrollbar.min.js"></script>
  <!-- <script src="/public/plugins/apexcharts/apexcharts.min.js"></script> -->
  <script src="/public/js/main.min.js"></script>
  <script src="/public/js/pages/dashboard.js"></script>
</body>

</html>